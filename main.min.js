var Board=function(t){function e(e,i,r,s){t.call(this),this.borderWidth=3,this.blockSize=r,this.widthBlockNumber=e,this.heightBlockNumber=i,this.boardWidth=this.blockSize*e+this.borderWidth*(e+1)+2*this.borderWidth,this.boardHeight=this.blockSize*i+this.borderWidth*(i+1)+2*this.borderWidth,s||this.drawBorder()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.drawBorder=function(){this.graphics.beginFill(16777215),this.graphics.drawRect(0,0,this.boardWidth,this.boardHeight),this.graphics.beginFill(0),this.graphics.drawRect(this.borderWidth,this.borderWidth,this.boardWidth-2*this.borderWidth,this.boardHeight-2*this.borderWidth),this.graphics.endFill()},r.clean=function(){this.graphics.beginFill(0),this.graphics.drawRect(this.borderWidth,this.borderWidth,this.boardWidth-2*this.borderWidth,this.boardHeight-2*this.borderWidth)},r.drawBoard=function(t){var e=this.borderWidth+this.blockSize;if(t)for(var i=0,r=2*this.borderWidth;i<t.length;i++,r+=e)if(t[i])for(var s=0,h=2*this.borderWidth;s<t[i].length;s++,h+=e)!t[i][s]||this.blockMap&&this.blockMap[i][s]?t[i][s]||this.blockMap&&!this.blockMap[i][s]||(this.graphics.beginFill(0),this.graphics.drawRect(h,r,this.blockSize,this.blockSize)):(this.graphics.beginFill(16777215),this.graphics.drawRect(h,r,this.blockSize,this.blockSize));this.graphics.endFill(),this.blockMap=t},r.drawShape=function(t){var e=this;this.graphics.beginFill(16777215);var i=2*this.borderWidth,r=this.borderWidth+this.blockSize;t.forEach(function(t){e.graphics.drawRect(i+r*t[1],i+r*t[0],e.blockSize,e.blockSize)})},e}(egret.Shape);egret.registerClass(Board,"Board");var Button=function(t){function e(e,i,r,s){t.call(this),this.borderWidth=3,this.borderRaduis=30,this.width=e,this.height=i,this.borderRaduis=(this.width+this.height)/20,this.text=r,this.clickHandler=s,this.render(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this),this.render()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.setClicklistener=function(t){this.clickHandler=t},r.click=function(t){this.clickHandler&&this.clickHandler(t)},r.onTouchBegin=function(t){this.changeBackGroudColor(16777215),this.label.textColor=0},r.onTouchEnd=function(t){this.changeBackGroudColor(0),this.label.textColor=16777215},r.render=function(){this.border=new egret.Shape,this.changeBackGroudColor(0),this.addChild(this.border),this.label=new egret.TextField,this.label.x=this.x,this.label.y=this.y,this.label.width=this.width,this.label.height=this.height,this.label.text=this.text,this.label.size=24,this.label.textAlign=egret.HorizontalAlign.CENTER,this.label.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this.label)},r.changeBackGroudColor=function(t){this.border.graphics.beginFill(16777215),this.border.graphics.drawRoundRect(0,0,this.width,this.height,this.borderRaduis),this.border.graphics.beginFill(t),this.border.graphics.drawRoundRect(this.borderWidth,this.borderWidth,this.width-2*this.borderWidth,this.height-2*this.borderWidth,this.borderRaduis),this.border.graphics.endFill()},e}(egret.Sprite);egret.registerClass(Button,"Button");var Dialog=function(t){function e(e){t.call(this),this.animateInterval=[300,400],this.event={show:[],hide:[]},this.target=e,this.target.parent.addChild(this),this.alpha=0,this.x=-(1/0),this.y=-(1/0),this.touchEnabled=!0,this.background=new egret.Shape,t.prototype.addChild.call(this,this.background),this.body=new egret.Sprite,t.prototype.addChild.call(this,this.body)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.show=function(t){var i=this;this.alpha=0,this.x=0,this.y=0,this.isShow=!0,this.parent.setChildIndex(this,this.parent.$children.length-1),e.coverStage(this),e.coverStage(this.background),e.coverStage(this.body),this.fillBackground(),this.tweenBlur(this.animateInterval[0],0,5),egret.Tween.get(this).to({alpha:1},this.animateInterval[1],egret.Ease.circIn).call(function(){i.event.show.forEach(function(t){return t.call(i)}),t&&t()})},r.hide=function(t){var e=this;this.alpha=1,egret.Tween.get(this).to({alpha:0},this.animateInterval[0],egret.Ease.circIn),this.tweenBlur(this.animateInterval[1],10,0,function(){e.alpha=0,e.x=-(1/0),e.y=-(1/0),e.isShow=!1,e.event.hide.forEach(function(t){return t.call(e)}),t&&t()})},r.addEventListener=function(t,e){this.event[t].push(e)},r.addChild=function(t){return this.body.addChild(t)},r.fillBackground=function(){this.background.alpha=0,this.background.graphics.beginFill(0),this.background.graphics.drawRect(0,0,this.background.width,this.background.height),this.background.graphics.endFill()},e.coverStage=function(t){t.x=0,t.y=0,t.width=t.stage.stageWidth,t.height=t.stage.stageHeight},r.tweenBlur=function(t,e,i,r){var s=this;if(this.blurFilter&&this.target.filters){var h=this.target.filters.indexOf(this.blurFilter);-1!=h&&this.target.filters.splice(h,1)}this.blurFilter=new egret.BlurFilter(e,e),this.target.filters?this.target.filters.push(this.blurFilter):this.target.filters=[this.blurFilter];var n=Math.max(e,i)-Math.min(e,i),o=i>e?1:-1,a=new egret.Timer(t/n,n);a.addEventListener(egret.TimerEvent.TIMER,function(){s.blurFilter.blurX+=o,s.blurFilter.blurY+=o,s.target.filters=s.target.filters},this),a.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){s.blurFilter.blurX=i,s.blurFilter.blurY=i,s.target.filters=s.target.filters,r&&r()},this),a.start()},e}(egret.Sprite);egret.registerClass(Dialog,"Dialog");var Controller=function(){function t(t){var e=this;this.clock=20,this.model=t,this.model.watch("activeShape",this.mapActiveShapeToBoard,this),this.model.watch("isEnd",function(t){t&&e.end()},this)}var e=(__define,t),i=e.prototype;return i.mapActiveShapeToBoard=function(t,e){var i=this,r=this.model.board.map(function(t){return t.slice(0)});if(t){e&&e.points.forEach(function(t){r[t[0]][t[1]]=0});var s=t.points.some(function(t){return t[0]>=i.model.boardHeight||t[1]>=i.model.boardWidth||t[0]<0||t[1]<0});if(s)return!1;var h=t.points.some(function(t){return Boolean(r[t[0]][t[1]])});if(h)return!1;t.points.forEach(function(t){r[t[0]][t[1]]=1}),this.model.setBoard(r)}return!0},i.initTimer=function(){var t=this;this.timer=new egret.Timer(20,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(e){t.clock+=t.model.level+1,t.clock>=20&&(t.model.activeShape?t.isLanding()?(t.model.setActiveShape(null),t.deleteFullLine()):t.moveActiveShapeDown():t.insertActiveShape(t.model.nextShape||Shape.getRandomShape(),!0),t.clock=0)},this)},i.deleteFullLine=function(){var t=this;if(this.model.board.some(function(t){return t.every(function(t){return 1===t})})){var e=this.model.board,i=this.model.board.map(function(t){return t.every(function(t){return 1===t})?[0,0,0,0,0,0,0,0,0,0]:t});this.timer.stop(),this.disappear=new egret.Timer(40,6),this.disappear.addEventListener(egret.TimerEvent.TIMER,function(r){r.target.currentCount%2?t.model.setBoard(i):t.model.setBoard(e)},this),this.disappear.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(i){var r=e.filter(function(t){return!t.every(function(t){return 1===t})});t.addScoreByLine(20-r.length);for(var s=r.length;20>s;s++)r.unshift([0,0,0,0,0,0,0,0,0,0]);t.model.setBoard(r),t.timer.start()},this),this.disappear.start()}},i.isLanding=function(){var t=this;return this.model.activeShape.points.reduce(function(t,e){return(void 0===t[e[1]]||t[e[1]]<e[0])&&(t[e[1]]=e[0]),t},[]).map(function(t,e){return[t,e]}).some(function(e){return e[0]+1>=t.model.boardHeight||1==t.model.board[e[0]+1][e[1]]})},i.reset=function(){this.model.setBoard(Shape.createZeroMatrix(10,20)),this.model.setActiveShape(null),this.model.setNextShape(null),this.model.setHoldShape(null),this.model.setScore(0),this.model.setLevel(1),this.model.setLine(0),this.model.setIsEnd(!1),this.initTimer()},i.start=function(){this.timer.start()},i.stop=function(){this.timer.stop()},i.end=function(){this.timer.stop(),this.disappear&&this.disappear.stop(),this.model.score>this.model.highestScore&&this.model.setHighestScore(this.model.score),this.model.setLastScore(this.model.score)},i.moveActiveShapeDown=function(){this.model.activeShape&&this.model.setActiveShape(this.model.activeShape.moveBy(1,0))},i.moveActiveShapeLeft=function(){this.model.activeShape&&this.model.setActiveShape(this.model.activeShape.moveBy(0,-1))},i.moveActiveShapeRight=function(){this.model.activeShape&&this.model.setActiveShape(this.model.activeShape.moveBy(0,1))},i.rotateActiveShape=function(){this.model.activeShape&&this.model.setActiveShape(this.model.activeShape.rotate())},i.switcheActiveShape=function(){if(this.model.activeShape&&!this.model.wasSwitch){var t=this.model.activeShape,e=this.model.holdShape;this.model.setHoldShape(Shape.getClassShape(t.type)),e?this.insertActiveShape(Shape.getClassShape(e.type),!1):this.insertActiveShape(this.model.nextShape,!0),this.model.wasSwitch=!0}},i.insertActiveShape=function(t,e){var i=t.points.reduce(function(t,e){return t[e[1]]=1,t},[]).reduce(function(t){return t+1},0);t=t.moveBy(0,Math.floor((10-i)/2));var r=this.model.setActiveShape(t);if(r)e&&(this.model.setNextShape(Shape.getRandomShape()),this.model.wasSwitch=!1);else{var s=this.model.board.map(function(t){return t.slice(0)});t.points.forEach(function(t){s[t[0]][t[1]]=1}),this.model.setBoard(s),this.model.setIsEnd(!0),this.timer.stop()}},i.landing=function(){var t=this;if(this.model.activeShape){for(var e=this.model.activeShape.points.reduce(function(t,e){return(void 0===t[e[1]]||t[e[1]]<e[0])&&(t[e[1]]=e[0]),t},[]).map(function(t,e){return[t,e]}),i=1;!e.some(function(e){return e[0]+i>=t.model.boardHeight||1==t.model.board[e[0]+i][e[1]]});)i++;this.model.setActiveShape(this.model.activeShape.moveBy(i-1,0)),this.clock=1/0}},i.addScoreByLine=function(t){this.model.setLine(this.model.line+t),this.model.setScore(this.model.score+t*(1+t)*50),this.model.setLevel(Math.floor(Math.sqrt((this.model.line+1)/10)))},t}();egret.registerClass(Controller,"Controller");var ErrorUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.create=function(t,e){var i={};return Object.getOwnPropertyNames(e).forEach(function(t){i[t]=e[t]}),Object.getOwnPropertyNames(t).forEach(function(e){i[e]=t[e]}),i},t.ERROR={type:"",getMessage:function(){return this.type+": 123"}},t}();egret.registerClass(ErrorUtil,"ErrorUtil");var KeyEventUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.addEventListener=function(e){document.addEventListener(e,function(i){if(t.pages[t.focusPage]&&t.pages[t.focusPage][e][i.keyCode]){var r=t.pages[t.focusPage][e][i.keyCode];r.forEach(function(t){return t[0].call(t[1],i)})}})},t.register=function(e,i,r,s,h){t.pages[e]||(t.pages[e]={keyup:[],keydown:[],keypress:[]}),t.pages[e][i][r]?t.pages[e][i][r].push([s,h]):t.pages[e][i][r]=[[s,h]]},t.focus=function(e){t.focusPage=e},t.pages={},t._constructor=function(){t.addEventListener("keydown"),t.addEventListener("keyup"),t.addEventListener("keypress")}(),t}();egret.registerClass(KeyEventUtil,"KeyEventUtil");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.model=new Model,this.controller=new Controller(this.model),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.createGameScene()},r.createGameScene=function(){this.initBackgroud(this.stage.stageWidth,this.stage.stageHeight),this.initStartDialog(),this.initPauseDialog(),this.initExitDialog(),this.startDialog.show(),this.initGameView()},r.initBackgroud=function(t,e){var i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),this.addChild(i)},r.initGameView=function(){var t=this;this.gameView=new GameView,this.addChild(this.gameView),this.model.watch("board",this.gameView.setBoard,this.gameView),this.model.watch("nextShape",this.gameView.setNextBoard,this.gameView),this.model.watch("holdShape",this.gameView.setHoldBoard,this.gameView),this.model.watch("score",this.gameView.setScore,this.gameView),this.model.watch("level",this.gameView.setLevel,this.gameView),this.model.watch("line",this.gameView.setLine,this.gameView),this.model.watch("isEnd",function(e){e&&t.startDialog.show()},this),KeyEventUtil.register("GameView","keydown",65,this.controller.moveActiveShapeLeft,this.controller),KeyEventUtil.register("GameView","keydown",37,this.controller.moveActiveShapeLeft,this.controller),KeyEventUtil.register("GameView","keydown",68,this.controller.moveActiveShapeRight,this.controller),KeyEventUtil.register("GameView","keydown",39,this.controller.moveActiveShapeRight,this.controller),KeyEventUtil.register("GameView","keydown",87,this.controller.rotateActiveShape,this.controller),KeyEventUtil.register("GameView","keydown",38,this.controller.rotateActiveShape,this.controller),KeyEventUtil.register("GameView","keydown",83,this.controller.moveActiveShapeDown,this.controller),KeyEventUtil.register("GameView","keydown",40,this.controller.moveActiveShapeDown,this.controller),KeyEventUtil.register("GameView","keydown",16,this.controller.switcheActiveShape,this.controller),KeyEventUtil.register("GameView","keydown",32,this.controller.landing,this);var e=function(){KeyEventUtil.focus(""),t.controller.stop(),t.pauseDialog.show()};this.gameView.pauseBtn.setClicklistener(e),KeyEventUtil.register("GameView","keyup",80,e,this);var i=function(){KeyEventUtil.focus(""),t.controller.stop(),t.exitDialog.show()};this.gameView.exitBtn.setClicklistener(i),KeyEventUtil.register("GameView","keyup",69,i,this)},r.initStartDialog=function(){var t=this;this.startDialog=new Dialog(this);var e=150,i=new egret.TextField;i.text="Tetris",i.x=0,i.y=e,i.width=this.stage.stageWidth,i.size=100,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,this.startDialog.addChild(i),e=e+100+100;var r=new Button(180,60,"[S]tart");r.x=(this.stage.stageWidth-180)/2,r.y=e,this.startDialog.addChild(r),e=e+60+50;var s=new egret.TextField;s.text="Highest Score: "+this.model.highestScore,s.x=0,s.y=e,s.width=this.stage.stageWidth,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.bold=!0,this.startDialog.addChild(s),e=e+30+30;var h=new egret.TextField;h.text="Last Score: "+this.model.lastScore,h.x=0,h.y=e,h.width=this.stage.stageWidth,h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.bold=!0,this.startDialog.addChild(h);var n=function(){KeyEventUtil.focus(""),t.controller.reset(),t.startDialog.hide()};r.setClicklistener(n),KeyEventUtil.register("StartDialog","keydown",83,n,this),this.startDialog.addEventListener("show",function(){KeyEventUtil.focus("StartDialog")}),this.startDialog.addEventListener("hide",function(){KeyEventUtil.focus("GameView"),t.controller.start()}),this.model.watch("highestScore",function(t){s.text="Highest Score: "+t},this),this.model.watch("lastScore",function(t){h.text="Last Score: "+t},this)},r.initPauseDialog=function(){var t=this;this.pauseDialog=new Dialog(this);var e=150,i=new egret.TextField;i.text="Pause",i.x=0,i.y=e,i.width=this.stage.stageWidth,i.size=100,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,this.pauseDialog.addChild(i),e=e+100+100;var r=new Button(180,60,"[R]esume");r.x=(this.stage.stageWidth-360-10)/2,r.y=e,this.pauseDialog.addChild(r);var s=function(){KeyEventUtil.focus(""),t.pauseDialog.hide(function(){KeyEventUtil.focus("GameView"),t.controller.start()})};r.setClicklistener(s),KeyEventUtil.register("PauseDialog","keyup",27,s,this),KeyEventUtil.register("PauseDialog","keyup",82,s,this);var h=new Button(180,60,"[E]xit");h.x=r.x+180+10,h.y=e,this.pauseDialog.addChild(h);var n=function(){KeyEventUtil.focus(""),t.pauseDialog.hide(function(){KeyEventUtil.focus("StartDialog"),t.startDialog.show()})};h.setClicklistener(n),KeyEventUtil.register("PauseDialog","keyup",69,n,this),this.pauseDialog.addEventListener("show",function(){KeyEventUtil.focus("PauseDialog")})},r.initExitDialog=function(){var t=this;this.exitDialog=new Dialog(this);var e=150,i=new egret.TextField;i.text="Exit",i.x=0,i.y=e,i.width=this.stage.stageWidth,i.size=100,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,this.exitDialog.addChild(i),e=e+100+100;var r=new Button(180,60,"[Y]es");r.x=(this.stage.stageWidth-360-10)/2,r.y=e,this.exitDialog.addChild(r);var s=function(){KeyEventUtil.focus(""),t.exitDialog.hide(function(){KeyEventUtil.focus("StartDialog"),t.startDialog.show()})};r.setClicklistener(s),KeyEventUtil.register("ExitDialog","keyup",89,s,this);var h=new Button(180,60,"[N]o");h.x=r.x+180+10,h.y=e,this.exitDialog.addChild(h);var n=function(){KeyEventUtil.focus(""),t.exitDialog.hide(function(){KeyEventUtil.focus("GameView"),t.controller.start()})};h.setClicklistener(n),KeyEventUtil.register("ExitDialog","keyup",27,n,this),KeyEventUtil.register("ExitDialog","keyup",78,n,this),this.exitDialog.addEventListener("show",function(){KeyEventUtil.focus("ExitDialog")})},e.blockLength=30,e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Model=function(){function t(){this._boardWidth=10,this._boardHeight=20,this._isEnd=!1,this.wasSwitch=!1,this.triggerStack=[],this.initial()}var e=__define,i=t,r=i.prototype;return r.initial=function(){this._board=Shape.createZeroMatrix(this._boardWidth,this._boardHeight),this._activeShape=null,this._nextShape=null,this._holdShape=null,this._score=0,this._lastScore=Number(localStorage.getItem("lastScore")||0),this._highestScore=Number(localStorage.getItem("highestScore")||0),this._level=0,this._line=0,this._callbackMap={}},e(r,"board",function(){return this._board}),e(r,"boardWidth",function(){return this._boardWidth}),e(r,"boardHeight",function(){return this._boardHeight}),e(r,"activeShape",function(){return this._activeShape}),e(r,"nextShape",function(){return this._nextShape}),e(r,"holdShape",function(){return this._holdShape}),e(r,"score",function(){return this._score}),e(r,"lastScore",function(){return this._lastScore}),e(r,"highestScore",function(){return this._highestScore}),e(r,"level",function(){return this._level}),e(r,"line",function(){return this._line}),e(r,"isEnd",function(){return this._isEnd}),r.setBoard=function(t){return this.setByPropertyName("board",t)},r.setActiveShape=function(t){return this.setByPropertyName("activeShape",t)},r.setNextShape=function(t){return this.setByPropertyName("nextShape",t)},r.setHoldShape=function(t){return this.setByPropertyName("holdShape",t)},r.setScore=function(t){return this.setByPropertyName("score",t)},r.setLastScore=function(t){var e=this.setByPropertyName("lastScore",t);return e&&localStorage.setItem("lastScore",this._lastScore+""),e},r.setHighestScore=function(t){var e=this.setByPropertyName("highestScore",t);return e&&localStorage.setItem("highestScore",this._highestScore+""),e},r.setLevel=function(t){return this.setByPropertyName("level",t)},r.setLine=function(t){return this.setByPropertyName("line",t)},r.setIsEnd=function(t){return this.setByPropertyName("isEnd",t)},r.triggerCallbacks=function(t,e,i){if(-1!=this.triggerStack.indexOf(t))throw"circle error";if(this._callbackMap[t]){this.triggerStack.push(t);var r=this._callbackMap[t].every(function(t){var r=t[0].call(t[1],e,i);return r||void 0===r});return this.triggerStack.pop(),r}},r.setByPropertyName=function(t,e){return this.triggerCallbacks(t,e,this["_"+t])?(this["_"+t]=e,!0):!1},r.watch=function(t,e,i){if(!this.hasOwnProperty("_"+t))throw"property is not defined!";this._callbackMap[t]?this._callbackMap[t].push([e,i]):this._callbackMap[t]=[[e,i]]},r.reset=function(t){return this.triggerCallbacks(t,this["_"+t],this["_"+t])},t}();egret.registerClass(Model,"Model");var GameView=function(t){function e(){var e=this;t.call(this),this.addEventListener(egret.Event.ENTER_FRAME,function(t){e.x&&(e.x=0),e.y&&(e.y=0),e.width!==e.stage.width&&(e.width=e.stage.width),e.height!==e.stage.height&&(e.height=e.stage.height)},this),this.board=new Board(10,20,30),this.nextLabel=new egret.TextField,this.nextBoard=new Board(4,4,30),this.holdLabel=new egret.TextField,this.holdBoard=new Board(4,4,30),this.level=new egret.TextField,this.score=new egret.TextField,this.line=new egret.TextField,this.pauseBtn=new Button(180,60,"[P]ause"),this.exitBtn=new Button(180,60,"[E]xit"),this.addChild(this.board),this.addChild(this.nextLabel),this.addChild(this.nextBoard),this.addChild(this.holdLabel),this.addChild(this.holdBoard),this.addChild(this.level),this.addChild(this.score),this.addChild(this.line),this.addChild(this.pauseBtn),this.addChild(this.exitBtn),this.layout()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.layout=function(){this.board.x=15,this.board.y=15;var t=this.board.width+30,e=15;this.nextLabel.text="Next",this.nextLabel.x=t,this.nextLabel.y=e,e+=30,this.nextBoard.x=t+30,this.nextBoard.y=e,e=e+120+21+15,this.holdLabel.text="Hold",this.holdLabel.x=t,this.holdLabel.y=e,e+=30,this.holdBoard.x=t+30,this.holdBoard.y=e,e=e+120+21+15,this.level.text="Level: 0",this.level.x=t+15,this.level.y=e,e=e+30+15,this.score.text="Score: 0",this.score.x=t+15,this.score.y=e,e=e+30+15,this.line.text="Line: 0",this.line.x=t+15,this.line.y=e,e=e+30+15,this.pauseBtn.x=t+15,this.pauseBtn.y=e,e=e+60+10,this.exitBtn.x=t+15,this.exitBtn.y=e},r.setBoard=function(t){this.board.drawBoard(t)},r.setNextBoard=function(t){this.nextBoard.clean(),t&&this.nextBoard.drawShape(t.points)},r.setHoldBoard=function(t){this.holdBoard.clean(),t&&this.holdBoard.drawShape(t.points)},r.setLevel=function(t){this.level.text="Level: "+t},r.setScore=function(t){this.score.text="Score: "+t},r.setLine=function(t){this.line.text="Line: "+t},e}(egret.Sprite);egret.registerClass(GameView,"GameView");var Shape=function(){function t(e,i,r,s){this._type=e,this._points=t.copy(i),this._center=r.slice(0),void 0!==s&&(this._points=this._points.map(function(t){return[t[0]+s[0],t[1]+s[1]]}),this._center=[this._center[0]+s[0],this._center[1]+s[1]])}var e=__define,i=t,r=i.prototype;return t.getRandomShape=function(){var e=Math.floor(Math.random()*t.shapes.length);return t.shapes[e]},t.getClassShape=function(e){return t.shapes[e]},t.copy=function(t){return t.map(function(t){return t.slice(0)})},t.createZeroMatrix=function(t,e){void 0===e&&(e=t);for(var i=new Array(e),r=0;e>r;r++){i[r]=new Array(t);for(var s=0;t>s;s++)i[r][s]=0}return i},e(r,"points",function(){return t.copy(this._points)}),e(r,"type",function(){return this._type}),r.moveBy=function(e,i){return new t(this._type,this._points.map(function(t){return[t[0]+e,t[1]+i]}),[this._center[0]+e,this._center[1]+i])},r.rotate=function(){var e=this,i=[[0,-1],[1,0]],r=this._points.map(function(t){return[t[0]-e._center[0],t[1]-e._center[1]]}).map(function(t){return[t[0]*i[0][0]+t[1]*i[1][0],t[0]*i[0][1]+t[1]*i[1][1]]}).map(function(t){return[t[0]+e._center[0],t[1]+e._center[1]]});return new t(this._type,r,this._center)},t.shapes=[new t(0,[[0,0],[0,1],[0,2],[0,3]],[.5,1.5]),new t(1,[[0,0],[0,1],[0,2],[1,0]],[0,1]),new t(2,[[0,0],[0,1],[0,2],[1,2]],[0,1]),new t(3,[[0,0],[0,1],[1,1],[1,2]],[1,1]),new t(4,[[1,0],[1,1],[0,1],[0,2]],[1,1]),new t(5,[[0,0],[0,1],[1,0],[1,1]],[.5,.5]),new t(6,[[0,1],[1,0],[1,1],[1,2]],[1,1])],t}();egret.registerClass(Shape,"Shape");